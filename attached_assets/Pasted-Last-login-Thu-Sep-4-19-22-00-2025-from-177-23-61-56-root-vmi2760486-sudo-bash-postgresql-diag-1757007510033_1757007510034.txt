Last login: Thu Sep  4 19:22:00 2025 from 177.23.61.56
root@vmi2760486:~# sudo bash postgresql-diagnostic.sh
LigAI Dashboard - DiagnÃ³stico PostgreSQL
================================================

1. Status do PostgreSQL:
âœ… PostgreSQL estÃ¡ rodando
ğŸ“‹ VersÃ£o detectada: PostgreSQL 12

2. Portas de escuta:
âœ… PostgreSQL escutando na porta 5432
tcp     LISTEN   0        244                                         127.0.0.1:5432                                  0.0.0.0:*
âš ï¸ Escutando apenas em localhost
âŒ PROBLEMA: PostgreSQL nÃ£o aceita conexÃµes externas

3. ConfiguraÃ§Ã£o postgresql.conf:
ğŸ“ Arquivo: /etc/postgresql/12/main/postgresql.conf
ğŸ”§ listen_addresses: nÃ£o encontrado
âŒ NÃƒO configurado para conexÃµes externas
ğŸ”§ port: port = 5432                            # (change requires restart)

4. ConfiguraÃ§Ã£o pg_hba.conf:
ğŸ“ Arquivo: /etc/postgresql/12/main/pg_hba.conf
ğŸ”§ Regras para usuÃ¡rio 'ligai':
   âœ… host    all             ligai           0.0.0.0/0               md5
   âœ… host    all             ligai           0.0.0.0/0               md5
   âœ… host    all             ligai           0.0.0.0/0               md5
   âœ… host    all             ligai           0.0.0.0/0               md5

5. ConfiguraÃ§Ã£o do Firewall:
ğŸ”¥ UFW Status:
5432                       ALLOW       Anywhere
5432/tcp                   ALLOW       Anywhere
5432 (v6)                  ALLOW       Anywhere (v6)
5432/tcp (v6)              ALLOW       Anywhere (v6)
âœ… Porta 5432 liberada no firewall

6. UsuÃ¡rio PostgreSQL 'ligai':
âœ… UsuÃ¡rio 'ligai' existe
ğŸ”§ PermissÃµes: t|f

7. Database 'ligai':
âŒ Database 'ligai' NÃƒO existe

8. Teste de ConexÃ£o:
ğŸ”§ Testando conexÃ£o local...
Password for user ligai:
âš ï¸ ConexÃ£o local requer senha
could not change directory to "/root": Permission denied
psql: error: FATAL:  database "ligai" does not exist

==================== RESUMO ====================

âŒ PROBLEMA 1: PostgreSQL nÃ£o aceita conexÃµes externas
   SoluÃ§Ã£o: Configurar listen_addresses = '*' em postgresql.conf
ğŸ”§ Execute: sudo bash configure-postgresql-external.sh

Para aplicar correÃ§Ãµes automaticamente:
sudo bash configure-postgresql-external.sh
root@vmi2760486:~# sudo bash configure-postgresql-external.sh
Configurando PostgreSQL para Acesso Externo
==================================================
could not change directory to "/root": Permission denied
[19:37:05] PostgreSQL versÃ£o detectada: 12.22(Ubuntu12
[19:37:05] Fazendo backup dos arquivos de configuraÃ§Ã£o...
[19:37:05] Configurando postgresql.conf...
grep: /etc/postgresql/12.22(Ubuntu12/main/postgresql.conf: No such file or directory
configure-postgresql-external.sh: line 64: /etc/postgresql/12.22(Ubuntu12/main/postgresql.conf: No such file or directory
grep: /etc/postgresql/12.22(Ubuntu12/main/postgresql.conf: No such file or directory
configure-postgresql-external.sh: line 70: /etc/postgresql/12.22(Ubuntu12/main/postgresql.conf: No such file or directory
[19:37:05] âœ… postgresql.conf configurado
[19:37:05] Configurando pg_hba.conf...
sed: can't read /etc/postgresql/12.22(Ubuntu12/main/pg_hba.conf: No such file or directory
sed: can't read /etc/postgresql/12.22(Ubuntu12/main/pg_hba.conf: No such file or directory
configure-postgresql-external.sh: line 83: /etc/postgresql/12.22(Ubuntu12/main/pg_hba.conf: No such file or directory
[19:37:05] âœ… pg_hba.conf configurado
[19:37:05] Configurando firewall...
Skipping adding existing rule
Skipping adding existing rule (v6)
[19:37:05] âœ… Firewall configurado para porta 5432
[19:37:05] Verificando usuÃ¡rio PostgreSQL 'ligai'...
ALTER ROLE
[19:37:06] âœ… UsuÃ¡rio ligai configurado
[19:37:06] Reiniciando PostgreSQL...
[19:37:08] âœ… PostgreSQL reiniciado com sucesso
[19:37:11] Testando conexÃ£o local...
Password for user ligai:
[AVISO] ConexÃ£o local falhou, mas isso pode ser normal se a senha estiver incorreta
[19:37:18] Verificando portas abertas...
configure-postgresql-external.sh: line 135: netstat: command not found
[AVISO] PostgreSQL pode nÃ£o estar escutando corretamente

ğŸ‰ CONFIGURAÃ‡ÃƒO CONCLUÃDA! ğŸ‰

ConfiguraÃ§Ãµes para PGAdmin:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Host:     109.123.251.250
Port:     5432
Database: ligai
Username: ligai
Password: ligai
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Dicas:
â€¢ Se ainda nÃ£o conectar, aguarde 1-2 minutos
â€¢ Certifique-se de que seu firewall local permite conexÃµes na porta 5432
â€¢ Teste com SSL Mode: 'Disable' no PGAdmin

Para verificar logs: journalctl -u postgresql -f
root@vmi2760486:~# sudo bash postgresql-diagnostic.sh
LigAI Dashboard - DiagnÃ³stico PostgreSQL
================================================

1. Status do PostgreSQL:
âœ… PostgreSQL estÃ¡ rodando
ğŸ“‹ VersÃ£o detectada: PostgreSQL 12

2. Portas de escuta:
âœ… PostgreSQL escutando na porta 5432
tcp     LISTEN   0        244                                         127.0.0.1:5432                                  0.0.0.0:*
âš ï¸ Escutando apenas em localhost
âŒ PROBLEMA: PostgreSQL nÃ£o aceita conexÃµes externas

3. ConfiguraÃ§Ã£o postgresql.conf:
ğŸ“ Arquivo: /etc/postgresql/12/main/postgresql.conf
ğŸ”§ listen_addresses: nÃ£o encontrado
âŒ NÃƒO configurado para conexÃµes externas
ğŸ”§ port: port = 5432                            # (change requires restart)

4. ConfiguraÃ§Ã£o pg_hba.conf:
ğŸ“ Arquivo: /etc/postgresql/12/main/pg_hba.conf
ğŸ”§ Regras para usuÃ¡rio 'ligai':
   âœ… host    all             ligai           0.0.0.0/0               md5
   âœ… host    all             ligai           0.0.0.0/0               md5
   âœ… host    all             ligai           0.0.0.0/0               md5
   âœ… host    all             ligai           0.0.0.0/0               md5

5. ConfiguraÃ§Ã£o do Firewall:
ğŸ”¥ UFW Status:
5432                       ALLOW       Anywhere
5432/tcp                   ALLOW       Anywhere
5432 (v6)                  ALLOW       Anywhere (v6)
5432/tcp (v6)              ALLOW       Anywhere (v6)
âœ… Porta 5432 liberada no firewall

6. UsuÃ¡rio PostgreSQL 'ligai':
âœ… UsuÃ¡rio 'ligai' existe
ğŸ”§ PermissÃµes: t|f

7. Database 'ligai':
âŒ Database 'ligai' NÃƒO existe

8. Teste de ConexÃ£o:
ğŸ”§ Testando conexÃ£o local...
Password for user ligai:
âš ï¸ ConexÃ£o local requer senha
could not change directory to "/root": Permission denied
psql: error: FATAL:  database "ligai" does not exist

==================== RESUMO ====================

âŒ PROBLEMA 1: PostgreSQL nÃ£o aceita conexÃµes externas
   SoluÃ§Ã£o: Configurar listen_addresses = '*' em postgresql.conf
ğŸ”§ Execute: sudo bash configure-postgresql-external.sh

Para aplicar correÃ§Ãµes automaticamente:
sudo bash configure-postgresql-external.sh
root@vmi2760486:~#